<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ìˆ˜ì–´ì˜ìƒ í•™ìŠµ ì‚¬ì´íŠ¸</title>
  <style>
    :root {
      --bg: #0f172a; /* slate-900 */
      --panel: #111827; /* gray-900 */
      --ink: #e5e7eb; /* gray-200 */
      --muted: #9ca3af; /* gray-400 */
      --accent: #22d3ee; /* cyan-400 */
      --accent-2: #60a5fa; /* blue-400 */
      --ok: #34d399; /* emerald-400 */
      --warn: #f59e0b; /* amber-500 */
      --danger: #fb7185; /* rose-400 */
    }
    * { box-sizing: border-box }
    body {
      margin: 0; padding: 0; background: var(--bg); color: var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, sans-serif;
    }
    header {
      position: sticky; top: 0; z-index: 10; backdrop-filter: blur(8px);
      background: rgba(15, 23, 42, 0.7); border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px 16px; }
    h1 { margin: 0 0 6px; font-size: 22px; letter-spacing: 0.2px }
    .sub { font-size: 13px; color: var(--muted) }

    .toolbar { display: flex; gap: 8px; align-items: center; margin-top: 12px; flex-wrap: wrap }
    button, .btn {
      border: 0; padding: 8px 12px; border-radius: 12px; cursor: pointer; color: #0b1220;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); font-weight: 700; font-size: 14px;
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.25);
    }
    button.secondary { background: #1f2937; color: var(--ink); box-shadow: none; border: 1px solid rgba(255,255,255,0.08) }
    button.ghost { background: transparent; color: var(--ink); border: 1px dashed rgba(255,255,255,0.18) }

    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 18px; padding: 18px 16px; }
    .card { grid-column: span 12; background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.09); border-radius: 16px; padding: 14px; box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    }
    @media (min-width: 760px){ .card { grid-column: span 6 } }
    @media (min-width: 1060px){ .card { grid-column: span 4 } }

    .card h3 { margin: 8px 0 10px; font-size: 18px }
    .meta { font-size: 12px; color: var(--muted); display: flex; gap: 10px; align-items: center; }
    .meta a { color: var(--accent) }

    video { width: 100%; border-radius: 12px; background: #000 }
    .controls { display: flex; gap: 8px; margin: 10px 0 2px; flex-wrap: wrap }

    .answer {
      margin-top: 8px; padding: 10px 12px; border-radius: 10px;
      background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.25);
      display: none; white-space: pre-wrap; line-height: 1.5;
    }

    .memo { margin-top: 12px }
    .memo label { font-size: 13px; color: var(--muted) }
    .memo textarea { width: 100%; min-height: 90px; border-radius: 12px; padding: 10px 12px; background: #0b1220; color: var(--ink);
      border: 1px solid rgba(255,255,255,0.12); resize: vertical }
    .memo-bar { display: flex; gap: 8px; align-items: center; margin-top: 8px; flex-wrap: wrap }
    .status { font-size: 12px; color: var(--muted) }
    .status.saved { color: var(--ok) }
    .status.rec { color: var(--warn) }

    footer { text-align: center; color: var(--muted); font-size: 12px; padding: 24px 0 60px }
    .hint { font-size: 12px; color: var(--muted) }

    .pill { padding: 2px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); font-size: 11px }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>ìˆ˜ì–´ì˜ìƒ í•™ìŠµ ì‚¬ì´íŠ¸</h1>
      <div class="sub">ìƒˆë¡œê³ ì¹¨í•  ë•Œë§ˆë‹¤ ì˜ìƒ ì¹´ë“œê°€ ëœë¤ìœ¼ë¡œ ì„ì…ë‹ˆë‹¤. ê° ì¹´ë“œì—ì„œ ë©”ëª¨ë¥¼ í…ìŠ¤íŠ¸/ìŒì„±ìœ¼ë¡œ ê¸°ë¡í•˜ê³ , <b>ì •ë‹µí™•ì¸</b>ìœ¼ë¡œ ìš©ë¡€ ë²ˆì—­ë¬¸ì„ í™•ì¸í•˜ì„¸ìš”.</div>
      <div class="toolbar">
        <button id="shuffleBtn" title="ì¹´ë“œ ìˆœì„œ ì„ê¸°">ğŸ”€ ìˆœì„œ ë‹¤ì‹œ ì„ê¸°</button>
        <button id="revealAllBtn" class="secondary" title="ëª¨ë“  ì¹´ë“œì˜ ì •ë‹µì„ í¼ì¹˜ê¸°/ìˆ¨ê¸°ê¸°">âœ… ì „ì²´ ì •ë‹µ í† ê¸€</button>
        <span class="hint">ìŒì„±ì…ë ¥: í¬ë¡¬/ì—£ì§€(ë°ìŠ¤í¬í†±) ê¶Œì¥ Â· ë§ˆì´í¬ ê¶Œí•œ í•„ìš”</span>
      </div>
    </div>
  </header>

  <main class="grid" id="grid"></main>

  <footer>
    Â© 2025 ìˆ˜ì–´ í•™ìŠµ Â· ë¡œì»¬ì— ë©”ëª¨ê°€ ìë™ ì €ì¥ë©ë‹ˆë‹¤. (ë¸Œë¼ìš°ì €/ê¸°ê¸°ë³„ ë¶„ë¦¬)
  </footer>

  <script>
    // ===== 1) ë°ì´í„°: í•œêµ­ì–´ ëŒ€ì‘í‘œí˜„ / ìš©ë¡€ ë²ˆì—­ë¬¸ / ë™ì˜ìƒ ì£¼ì†Œ =====
    /**
     * í•­ëª© ì¶”ê°€ ë°©ë²•:
     *   data.push({ k: "í•œêµ­ì–´ ëŒ€ì‘í‘œí˜„", ex: "ìš©ë¡€ ë²ˆì—­ë¬¸", src: "ë™ì˜ìƒ mp4 ì£¼ì†Œ" });
     */
    const data = [
      { k: "ì¢…", ex: "ë‚˜ëŠ” ë”¸ê³¼ ê±·ë˜ ì¤‘ì— ë”¸ì´ ì¢…ì„ ì‚¬ë‹¬ë¼ê³  ì¡¸ë¼ì„œ ë”¸ì—ê²Œ ì¢…ì„ ì‚¬ ì£¼ì—ˆë‹¤.", src: "https://ksldict.korean.go.kr/kslserv/signFile/video/exmp/202410/LJnoOaDhWmp79ayX.mp4" },
      { k: "ì¢…", ex: "ìƒˆí•´ë¥¼ ë§ì•„ ì œì•¼ì˜ ì¢…ì†Œë¦¬ê°€ ìš¸ë ¤ í¼ì¡Œë‹¤.", src: "https://ksldict.korean.go.kr/kslserv/signFile/video/exmp/202410/q7oplifUF3jxiflF.mp4" },
      // ì—¬ê¸°ì— ê³„ì† ì¶”ê°€í•˜ì„¸ìš”.
    ];

    // ===== 2) ìœ í‹¸: ì„ê¸° (Fisher-Yates) =====
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // ===== 3) ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ =====
    const MEMO_KEY = (src) => `memo::${src}`;
    const ANSWER_SHOWN_KEY = (src) => `answer::shown::${src}`;

    // ===== 4) ìŒì„± ì¸ì‹ ì¤€ë¹„ =====
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    function createRecognizer(lang='ko-KR'){
      if(!SpeechRecognition) return null;
      const r = new SpeechRecognition();
      r.lang = lang;
      r.continuous = false;
      r.interimResults = true;
      r.maxAlternatives = 1;
      return r;
    }

    // ===== 5) ì¹´ë“œ ë Œë”ë§ =====
    const grid = document.getElementById('grid');

    function render(cards){
      grid.innerHTML = '';
      cards.forEach(item => {
        const card = document.createElement('section');
        card.className = 'card';

        const title = document.createElement('h3');
        title.textContent = `í•œêµ­ì–´ ëŒ€ì‘í‘œí˜„: ${item.k}`;

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `<span class="pill">í•™ìŠµ ì¹´ë“œ</span><span>â€¢</span><a href="${item.src}" target="_blank" rel="noopener">ë™ì˜ìƒ ì£¼ì†Œ ì—´ê¸°</a>`;

        const v = document.createElement('video');
        v.controls = true; v.preload = 'metadata'; v.src = item.src;

        const controls = document.createElement('div');
        controls.className = 'controls';

        const btnAnswer = document.createElement('button');
        btnAnswer.className = 'secondary';
        btnAnswer.textContent = 'ì •ë‹µí™•ì¸';

        const btnReplay = document.createElement('button');
        btnReplay.className = 'ghost';
        btnReplay.textContent = 'â†º ì²˜ìŒë¶€í„°';

        const answer = document.createElement('div');
        answer.className = 'answer';
        answer.textContent = item.ex;

        // ì´ì „ í‘œì‹œ ìƒíƒœ ë³µì›
        const wasShown = localStorage.getItem(ANSWER_SHOWN_KEY(item.src)) === '1';
        if(wasShown){ answer.style.display = 'block' }

        btnAnswer.addEventListener('click', () => {
          const visible = answer.style.display === 'block';
          answer.style.display = visible ? 'none' : 'block';
          localStorage.setItem(ANSWER_SHOWN_KEY(item.src), visible ? '0' : '1');
        });

        btnReplay.addEventListener('click', () => { v.currentTime = 0; v.play(); });

        controls.append(btnAnswer, btnReplay);

        // ë©”ëª¨ ì˜ì—­
        const memoWrap = document.createElement('div');
        memoWrap.className = 'memo';

        const memoLabel = document.createElement('label');
        memoLabel.textContent = 'ë©”ëª¨';

        const ta = document.createElement('textarea');
        ta.placeholder = 'í•™ìŠµ ì¤‘ ë©”ëª¨ë¥¼ ì‘ì„±í•˜ì„¸ìš”. (ìë™ ì €ì¥)';
        ta.value = localStorage.getItem(MEMO_KEY(item.src)) || '';

        const memoBar = document.createElement('div');
        memoBar.className = 'memo-bar';

        const btnMic = document.createElement('button');
        btnMic.className = 'secondary';
        btnMic.textContent = SpeechRecognition ? 'ğŸ™ï¸ ìŒì„±ì…ë ¥ ì‹œì‘' : 'ğŸ™ï¸ ìŒì„±ì…ë ¥ ë¶ˆê°€';
        if(!SpeechRecognition){ btnMic.disabled = true; }

        const btnClear = document.createElement('button');
        btnClear.className = 'ghost';
        btnClear.textContent = 'ğŸ§¹ ë©”ëª¨ ì§€ìš°ê¸°';

        const status = document.createElement('span');
        status.className = 'status';
        status.textContent = 'ì €ì¥ ì•ˆ ë¨';

        // ì €ì¥ ë¡œì§
        let saveTimer = null;
        function scheduleSave(){
          status.classList.remove('saved');
          status.textContent = 'ì €ì¥ ì¤‘â€¦';
          clearTimeout(saveTimer);
          saveTimer = setTimeout(() => {
            localStorage.setItem(MEMO_KEY(item.src), ta.value);
            status.classList.add('saved');
            status.textContent = 'ì €ì¥ë¨';
          }, 400);
        }
        ta.addEventListener('input', scheduleSave);

        btnClear.addEventListener('click', () => {
          ta.value = '';
          localStorage.removeItem(MEMO_KEY(item.src));
          status.classList.remove('saved');
          status.textContent = 'ë¹„ì›Œì§';
        });

        // ìŒì„± ì¸ì‹ ë™ì‘
        let rec = null; let recognizing = false;
        btnMic.addEventListener('click', () => {
          if(!SpeechRecognition) return;
          if(!recognizing){
            rec = createRecognizer('ko-KR');
            if(!rec) return;
            recognizing = true;
            btnMic.textContent = 'ğŸ›‘ ìŒì„±ì…ë ¥ ì¤‘ì§€';
            status.classList.add('rec');
            status.textContent = 'ìŒì„± ì¸ì‹ ì¤‘â€¦';

            let interim = '';
            rec.onresult = (e) => {
              let finalText = '';
              for(let i=e.resultIndex; i<e.results.length; i++){
                const r = e.results[i];
                if(r.isFinal){ finalText += r[0].transcript; }
                else { interim += r[0].transcript; }
              }
              if(finalText){
                // ë©”ëª¨ì— ì´ì–´ ë¶™ì´ê¸°
                ta.value = (ta.value ? (ta.value + ' ') : '') + finalText.trim();
                scheduleSave();
              }
            };
            rec.onerror = (e) => {
              status.classList.remove('rec');
              status.textContent = 'ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ' + (e.error || 'ì•Œ ìˆ˜ ì—†ìŒ');
              recognizing = false;
              btnMic.textContent = 'ğŸ™ï¸ ìŒì„±ì…ë ¥ ì‹œì‘';
            };
            rec.onend = () => {
              status.classList.remove('rec');
              if(recognizing){
                // ì‚¬ìš©ìê°€ ì¤‘ì§€ ëˆ„ë¥´ì§€ ì•Šì•˜ìœ¼ë©´ ìë™ ì¢…ë£Œ ì•Œë¦¼
                status.textContent = 'ìŒì„± ì…ë ¥ ì¢…ë£Œ';
                recognizing = false;
                btnMic.textContent = 'ğŸ™ï¸ ìŒì„±ì…ë ¥ ì‹œì‘';
              }
            };
            try { rec.start(); } catch(err){
              status.classList.remove('rec');
              status.textContent = 'ì‹œì‘ ì‹¤íŒ¨: ' + err.message;
              recognizing = false;
              btnMic.textContent = 'ğŸ™ï¸ ìŒì„±ì…ë ¥ ì‹œì‘';
            }
          } else {
            // ì •ì§€
            recognizing = false;
            try { rec && rec.stop(); } catch {}
            btnMic.textContent = 'ğŸ™ï¸ ìŒì„±ì…ë ¥ ì‹œì‘';
            status.classList.remove('rec');
            status.textContent = 'ìŒì„± ì…ë ¥ ì¤‘ì§€';
          }
        });

        memoBar.append(btnMic, btnClear, status);
        memoWrap.append(memoLabel, ta, memoBar);

        card.append(title, meta, v, controls, answer, memoWrap);
        grid.append(card);
      });
    }

    // ===== 6) ì´ˆê¸° ì„ì–´ì„œ ë Œë” =====
    let current = shuffle(data);
    render(current);

    // ===== 7) ìƒë‹¨ íˆ´ë°” =====
    document.getElementById('shuffleBtn').addEventListener('click', () => {
      current = shuffle(data);
      render(current);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    document.getElementById('revealAllBtn').addEventListener('click', () => {
      // í˜„ì¬ ë³´ì´ëŠ” ì¹´ë“œë“¤ì˜ ì •ë‹µì„ ëª¨ë‘ í† ê¸€
      const anyHidden = [...document.querySelectorAll('.answer')].some(a => a.style.display !== 'block');
      document.querySelectorAll('.answer').forEach((a, idx) => {
        const card = a.closest('.card');
        const video = card.querySelector('video');
        if(anyHidden){ a.style.display = 'block'; localStorage.setItem(ANSWER_SHOWN_KEY(video.src), '1'); }
        else { a.style.display = 'none'; localStorage.setItem(ANSWER_SHOWN_KEY(video.src), '0'); }
      });
    });
  </script>
</body>
</html>
